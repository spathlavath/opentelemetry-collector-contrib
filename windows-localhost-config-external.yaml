# Alternative config using public IP (if you prefer external connection)
receivers:
  newrelicsqlserver:
    # PUBLIC IP CONNECTION - Less optimal but works
    hostname: "20.185.235.202" # Your VM's public IP
    port: "1433"
    username: "otel_collector"
    password: "Admin@1234"
    collection_interval: 60s
    timeout: 60s # Increased timeout for network connections

    # TLS settings for external connections
    enable_ssl: false # Set to true for production with proper certificates
    trust_server_certificate: true

    # All metric configurations (copied from working config)
    enable_database_sample_metrics: true
    enable_instance_memory_metrics: true
    enable_instance_comprehensive_stats: true
    enable_instance_stats: true
    enable_instance_buffer_pool_hit_percent: true
    enable_instance_process_counts: true
    enable_instance_runnable_tasks: true
    enable_instance_disk_metrics: true
    enable_instance_active_connections: true
    enable_instance_buffer_pool_size: true
    enable_instance_target_memory_metrics: true
    enable_instance_performance_ratios_metrics: true
    enable_instance_index_metrics: true
    enable_instance_lock_metrics: true
    enable_security_metrics: true
    enable_security_principals_metrics: true
    enable_security_role_members_metrics: true
    enable_latch_wait_time_metrics: true
    enable_buffer_metrics: true
    enable_database_reserve_metrics: true
    enable_disk_metrics_in_bytes: true
    enable_io_metrics: true
    enable_log_growth_metrics: true
    enable_page_file_metrics: true
    enable_page_file_total_metrics: true
    enable_memory_metrics: true
    enable_memory_total_metrics: true
    enable_memory_available_metrics: true
    enable_memory_utilization_metrics: true
    enable_database_principals_details_metrics: true
    enable_database_principals_summary_metrics: true
    enable_database_principals_activity_metrics: true
    enable_database_role_membership_details_metrics: true
    enable_database_role_membership_summary_metrics: true
    enable_database_role_hierarchy_metrics: true
    enable_database_role_activity_metrics: true
    enable_database_role_permission_matrix_metrics: true
    enable_database_size_metrics: true
    enable_database_transaction_log_metrics: true
    enable_database_log_space_usage_metrics: true
    enable_user_connection_status_metrics: true
    enable_user_connection_summary_metrics: true
    enable_user_connection_utilization_metrics: true
    enable_user_connection_client_metrics: false
    enable_user_connection_client_summary: true
    enable_user_connection_stats_metrics: true
    enable_failed_login_metrics: true
    enable_failed_login_summary_metrics: true
    enable_failover_cluster_replica_metrics: true
    enable_failover_cluster_replica_state_metrics: true
    enable_failover_cluster_availability_group_health_metrics: true
    enable_failover_cluster_availability_group_metrics: true
    enable_failover_cluster_redo_queue_metrics: true
    enable_query_monitoring: true
    query_monitoring_response_time_threshold: 1000
    query_monitoring_count_threshold: 10
    query_monitoring_fetch_interval: 15
    query_monitoring_text_truncate_limit: 1000
    max_concurrent_workers: 5

exporters:
  otlphttp:
    endpoint: "https://staging-otlp.nr-data.net:4318"
    headers:
      api-key: "abc7b84730116eb478ad6b79719e4d64FFFFNRAL"
    compression: gzip
    timeout: 30s

  debug:
    verbosity: detailed
    sampling_initial: 5
    sampling_thereafter: 200

processors:
  resource:
    attributes:
      - key: service.name
        value: "azure-mssql-windows-external" # Changed to indicate external connection
        action: upsert
      - key: collector.connection.type
        value: "external-ip"
        action: upsert
      - key: host.ip
        value: "20.185.235.202"
        action: upsert
      - key: cloud.provider
        value: "azure"
        action: upsert

  batch:
    timeout: 5s
    send_batch_size: 100
    send_batch_max_size: 1000

service:
  telemetry:
    logs:
      level: debug
      development: true
    metrics:
      level: detailed

  pipelines:
    metrics:
      receivers: [newrelicsqlserver]
      processors: [resource, batch]
      exporters: [debug, otlphttp]

  extensions: []

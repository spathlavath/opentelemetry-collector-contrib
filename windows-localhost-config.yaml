receivers:
  newrelicsqlserver:
    # OPTION 1: Use Windows Computer Name (Recommended for local connection)
    # hostname: "pkudikyala-wind"  # Your Azure VM computer name

    # OPTION 2: Use localhost (Simple local connection) - RECOMMENDED FOR WINDOWS VM
    hostname: "localhost"

    # OPTION 3: Use private IP (Azure internal network)
    # hostname: "172.16.0.4"

    # OPTION 4: Use public IP (external connection)
    # hostname: "74.225.24.140"

    port: "1433"
    username: "otel_collector"
    password: "Admin@1234"
    collection_interval: 60s
    timeout: 45s

    # TLS settings - can be disabled for localhost connections
    enable_ssl: false
    trust_server_certificate: true

    # =============================================================================
    # METRIC CONFIGURATION - Same as your working local setup
    # =============================================================================

    # Core Database Sample Metrics
    enable_database_sample_metrics: true

    # Instance-level Metrics
    enable_instance_memory_metrics: true
    enable_instance_comprehensive_stats: true
    enable_instance_stats: true
    enable_instance_buffer_pool_hit_percent: true
    enable_instance_process_counts: true
    enable_instance_runnable_tasks: true
    enable_instance_disk_metrics: true
    enable_instance_active_connections: true
    enable_instance_buffer_pool_size: true
    enable_instance_target_memory_metrics: true
    enable_instance_performance_ratios_metrics: true
    enable_instance_index_metrics: true
    enable_instance_lock_metrics: true

    # Security Metrics
    enable_security_metrics: true
    enable_security_principals_metrics: true
    enable_security_role_members_metrics: true

    # Wait Time Metrics
    enable_latch_wait_time_metrics: true

    # Database Metrics
    enable_buffer_metrics: true
    enable_database_reserve_metrics: true
    enable_disk_metrics_in_bytes: true
    enable_io_metrics: true
    enable_log_growth_metrics: true
    enable_page_file_metrics: true
    enable_page_file_total_metrics: true
    enable_memory_metrics: true
    enable_memory_total_metrics: true
    enable_memory_available_metrics: true
    enable_memory_utilization_metrics: true

    # Database Security Metrics
    enable_database_principals_details_metrics: true
    enable_database_principals_summary_metrics: true
    enable_database_principals_activity_metrics: true

    # Database Role Membership Metrics
    enable_database_role_membership_details_metrics: true
    enable_database_role_membership_summary_metrics: true
    enable_database_role_hierarchy_metrics: true
    enable_database_role_activity_metrics: true
    enable_database_role_permission_matrix_metrics: true

    # Database Size and Transaction Log Metrics
    enable_database_size_metrics: true
    enable_database_transaction_log_metrics: true
    enable_database_log_space_usage_metrics: true

    # User Connection Metrics
    enable_user_connection_status_metrics: true
    enable_user_connection_summary_metrics: true
    enable_user_connection_utilization_metrics: true
    enable_user_connection_client_metrics: false # Keep disabled to avoid timeout
    enable_user_connection_client_summary: true
    enable_user_connection_stats_metrics: true

    # Authentication and Failed Login Metrics
    enable_failed_login_metrics: true
    enable_failed_login_summary_metrics: true

    # AlwaysOn Failover Cluster Metrics (Your main focus!)
    enable_failover_cluster_replica_metrics: true
    enable_failover_cluster_replica_state_metrics: true
    enable_failover_cluster_availability_group_health_metrics: true
    enable_failover_cluster_availability_group_metrics: true
    enable_failover_cluster_redo_queue_metrics: true

    # Query Monitoring Configuration
    enable_query_monitoring: true
    query_monitoring_response_time_threshold: 1000
    query_monitoring_count_threshold: 10
    query_monitoring_fetch_interval: 15
    query_monitoring_text_truncate_limit: 1000
    max_concurrent_workers: 5

exporters:
  # New Relic OTLP exporter for staging (same as your working setup)
  otlphttp:
    endpoint: "https://staging-otlp.nr-data.net:4318"
    headers:
      api-key: "abc7b84730116eb478ad6b79719e4d64FFFFNRAL"
    compression: gzip
    timeout: 30s

  # Debug exporter to see what's being sent
  debug:
    verbosity: detailed
    sampling_initial: 5
    sampling_thereafter: 200

processors:
  # Add resource attributes to identify this as the Windows VM source
  resource:
    attributes:
      - key: service.name
        value: "azure-mssql-pkudikyala-wind"
        action: upsert
      - key: service.version
        value: "1.0.0"
        action: upsert
      - key: deployment.environment
        value: "staging"
        action: upsert
      - key: host.name
        value: "pkudikyala-wind" # Windows computer name
        action: upsert
      - key: host.ip
        value: "74.225.24.140" # Updated public IP
        action: upsert
      - key: host.private.ip
        value: "172.16.0.4" # Private IP
        action: upsert
      - key: cloud.provider
        value: "azure"
        action: upsert
      - key: cloud.region
        value: "southindia"
        action: upsert
      - key: monitoring.type
        value: "sql-server-computername"
        action: upsert
      - key: collector.location
        value: "windows-vm-onhost"
        action: upsert

  # Batch metrics for efficiency
  batch:
    timeout: 5s
    send_batch_size: 100
    send_batch_max_size: 1000

service:
  telemetry:
    logs:
      level: debug # Enable debug logging to see what's happening
      development: true
    metrics:
      level: detailed

  pipelines:
    metrics:
      receivers: [newrelicsqlserver]
      processors: [resource, batch]
      exporters: [debug, otlphttp] # Debug first to see all metrics

  extensions: []

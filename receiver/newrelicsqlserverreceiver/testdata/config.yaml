extensions:
service:
  pipelines:
    metrics:
      receivers: [newrelicsqlserver]
      processors: [  resource]
      exporters: [otlphttp, debug]
    logs:
      receivers: [newrelicsqlserver]
      processors: [ resource]
      exporters: [otlphttp, debug]
      
  telemetry:
    logs:
      level: info  
    metrics:
      level: detailed

processors:
  # batch:
  #   timeout: 10s
  #   send_batch_size: 1024
  
  resource:
    attributes:
      - key: server.address
        value: "sqlserver-otel"
        action: upsert
      - key: server.port
        value: "1433"
        action: upsert

receivers:
  newrelicsqlserver:
    hostname: "74.225.3.34"                    # e.g., "your-sql-server.com" or "192.168.1.100"
    port: "1433"                # Default SQL Server port
    username: "sa"              # e.g., "monitoring_user"
    password: "AbAnTaPassword@123"              # Your SQL Server password
    monitored_databases: [AdventureWorks2022,AnalyticsDB,LoadTestDB,PlanHandleTest,ReportingDB]  # List of databases to monitor, e.g., ["master", "YourDB",]

    timeout: 600s
    
    collection_interval: 60s

    query_monitoring_fetch_interval: 60       # seconds - captures queries from last 60 seconds (matches collection_interval)
    enable_query_monitoring: true
    query_monitoring_response_time_threshold: 100  # milliseconds - 0 = capture all queries (no threshold) for debugging
    query_monitoring_text_truncate_limit: 4096  # characters - maximum length of SQL text in query monitoring results (4KB - 2 bytes)
    enable_interval_based_averaging: true          # Enable delta-based interval calculations
    interval_calculator_cache_ttl_minutes: 10      # Cache TTL for query state (10 minutes)
    query_monitoring_count_threshold: 20  # max: 50

exporters:
  otlphttp:
    endpoint: "https://staging-otlp.nr-data.net:4318"
    headers:
      api-key: "731dfaae442f1e389ada62f6aed24d74FFFFNRAL"
    tls:
      insecure: false
    retry_on_failure:
      enabled: true
      initial_interval: 1s
      max_interval: 30s
      max_elapsed_time: 300s
    sending_queue:
      enabled: true
      num_consumers: 2
      queue_size: 100
    compression: gzip
    timeout: 30s

  debug:
    verbosity: detailed
